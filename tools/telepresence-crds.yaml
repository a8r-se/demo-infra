---
# Source: telepresence-crds/templates/ispec.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  creationTimestamp: null
  name: ispecs.getambassador.io
spec:
  group: getambassador.io
  names:
    kind: InterceptSpecification
    plural: ispecs
    shortNames:
    - is
    singular: ispec
  scope: Namespaced
  versions:
  - name: v1alpha3
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: The Intercept Specification defines Telepresence intercepts.
            properties:
              connection:
                description: Connection properties to use when Telepresence connects
                  to the cluster.
                properties:
                  alsoProxy:
                    description: Additional comma separated list of CIDR to proxy.
                    items:
                      type: string
                    type: array
                  as:
                    description: Username to impersonate for the operation.
                    type: string
                  asGroups:
                    description: Groups to impersonate for the operation.
                    items:
                      type: string
                    type: array
                  asUID:
                    description: UID to impersonate for the operation.
                    type: string
                  cluster:
                    description: The name of the kubeconfig cluster to use
                    type: string
                  context:
                    description: The name of the kubeconfig context to use
                    type: string
                  managerNamespace:
                    description: The namespace where the traffic manager is to be
                      found.
                    pattern: ^[a-z0-9][a-z0-9-]{1,62}$
                    type: string
                  mappedNamespaces:
                    description: The namespaces that Telepresence will be concerned
                      with
                    items:
                      description: RFC 1123 label name
                      pattern: ^[a-z0-9][a-z0-9-]{1,62}$
                      type: string
                    type: array
                  neverProxy:
                    description: Comma separated list of CIDR to never proxy.
                    items:
                      type: string
                    type: array
                  user:
                    description: The name of the kubeconfig user to use
                    type: string
                type: object
              handlers:
                items:
                  oneOf:
                  - not:
                      required:
                      - docker
                    required:
                    - script
                  - not:
                      required:
                      - script
                    required:
                    - docker
                  properties:
                    docker:
                      description: docker run/build/compose [OPTIONS] IMAGE[:TAG|@DIGEST]
                        [COMMAND] [ARG...]
                      oneOf:
                      - not:
                          required:
                          - build
                          - compose
                        required:
                        - image
                      - not:
                          required:
                          - image
                          - compose
                        required:
                        - build
                      - not:
                          required:
                          - image
                          - build
                        required:
                        - compose
                      properties:
                        args:
                          description: Optional command arguments, or flags to "docker
                            compose up"
                          items:
                            type: string
                          type: array
                        build:
                          description: Build Docker image from source
                          properties:
                            args:
                              description: Optional docker build command arguments
                              items:
                                type: string
                              type: array
                            context:
                              description: A path to a directory containing a Dockerfile,
                                or a url to a git repository
                              type: string
                          required:
                          - context
                          type: object
                        command:
                          description: Optional command. Not applicable for "compose".
                          type: string
                        compose:
                          description: Do "docker compose up" on a Docker Compose
                            specification
                          properties:
                            context:
                              description: A path to a Docker Compose file, or a directory
                                containing a "*-compose.yml" file
                              type: string
                            services:
                              items:
                                properties:
                                  behavior:
                                    description: The intended usage of the service
                                    enum:
                                    - local
                                    - remote
                                    - interceptHandler
                                    type: string
                                  intercepts:
                                    description: |
                                      Optionally limit this service to a specific intercepts. Relevant if the compose handler is
                                      used by multiple intercepts that maps to different services.
                                    items:
                                      description: Name of intercept that uses this
                                        compose handler.
                                      maxLength: 64
                                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                                      type: string
                                    type: array
                                  mapping:
                                    description: Mapping to a remote service. Only
                                      valid when behavior is remote
                                    properties:
                                      name:
                                        description: The name of the remote service
                                        maxLength: 64
                                        pattern: ^[a-z][a-z0-9-]*$
                                        type: string
                                      namespace:
                                        description: The namespace for the remote
                                          service
                                        maxLength: 64
                                        pattern: ^[a-z0-9][a-z0-9-]*$
                                        type: string
                                    required:
                                    - name
                                    type: object
                                  name:
                                    description: The name of an service in the Docker
                                      Compose file.
                                    type: string
                                required:
                                - name
                                type: object
                              type: array
                            spec:
                              x-kubernetes-preserve-unknown-fields: true
                          type: object
                        image:
                          description: Image to run in the form IMAGE[:TAG|@DIGEST]
                          pattern: ^([a-zA-Z][a-zA-Z0-9._-]+(:\d+)?/)?[a-z0-9._-]+(/[a-z0-9._-]+)*((@[a-z0-9]+:[a-z0-9]+)|(:[a-zA-Z0-9._-]{1,128}))?$
                          type: string
                        options:
                          description: Options (flags) to pass to docker build/run/compose
                          items:
                            type: string
                          type: array
                        ports:
                          description: Non intercept related ports exposed to the
                            host, such as ports used for debugging
                          items:
                            maximum: 65535
                            minimum: 1
                            type: integer
                          type: array
                      type: object
                    environment:
                      description: Additional environment
                      items:
                        properties:
                          name:
                            pattern: ^[a-zA-Z_][a-zA-Z0-9_]*$
                            type: string
                          value:
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                      x-kubernetes-list-map-keys:
                      - name
                      x-kubernetes-list-type: map
                    name:
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                    script:
                      description: Run a script using a shell
                      properties:
                        run:
                          description: Script to run with a shell.
                          type: string
                        shell:
                          description: The shell used when running the script.
                          enum:
                          - bash
                          - zsh
                          - sh
                          type: string
                      required:
                      - run
                      type: object
                    stopGracePeriod:
                      description: Number of seconds to wait after a SIGTERM before
                        the SIGKILL arrives
                      type: integer
                  required:
                  - name
                  type: object
                maxItems: 64
                minItems: 1
                type: array
                x-kubernetes-list-map-keys:
                - name
                x-kubernetes-list-type: map
              name:
                description: An name to give to the specification.
                pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                type: string
              prerequisites:
                items:
                  description: Things to create prior to starting any intercepts,
                    and delete once the intercept is complete.
                  properties:
                    create:
                      description: A handler to create things prior to starting any
                        intercepts.
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                    delete:
                      description: A handler to delete the created things once all
                        intercepts have ended.
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                  required:
                  - create
                  type: object
                maxItems: 16
                type: array
              workloads:
                description: Remote workloads that are intercepted, keyed by workload
                  name.
                items:
                  description: An intercepted workload (Deployment, ReplicaSet or
                    StatefulSet), keyed by name.
                  maxProperties: 3
                  properties:
                    intercepts:
                      description: The services and/or ports to intercept
                      items:
                        properties:
                          enabled:
                            description: If set to false, disables this intercept.
                              Default is true
                            type: boolean
                          global:
                            description: If true, then intercept all tcp/udp traffic.
                              Mutually exclusive with headers and pathXxx properties
                            type: boolean
                          handler:
                            description: The intercept handler that handles this intercept.
                            maxLength: 64
                            pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                            type: string
                          headers:
                            description: Headers that will filter the intercept. If
                              omitted or empty, and if global isn't explicitly set
                              to true, an auto header will be generated
                            items:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                            x-kubernetes-list-map-keys:
                            - name
                            x-kubernetes-list-type: map
                          localAddress:
                            description: The local IP address that will receive the
                              intercepted traffic.
                            pattern: ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$
                            type: string
                          localPort:
                            description: The local port that will receive the intercepted
                              traffic.
                            maximum: 65535
                            minimum: 1
                            type: integer
                          meta:
                            description: Metadata that will be returned by the Telepresence
                              API server
                            items:
                              properties:
                                name:
                                  pattern: ^[a-zA-Z][a-zA-Z0-9._-]*$
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                            x-kubernetes-list-map-keys:
                            - name
                            x-kubernetes-list-type: map
                          mountPoint:
                            description: The local directory or drive where the remote
                              volumes are mounted
                            type: string
                          name:
                            description: Optional name of the intercept.
                            maxLength: 64
                            pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                            type: string
                          pathEqual:
                            description: Path filter for the intercept.
                            type: string
                          pathPrefix:
                            description: Path prefix filter for the intercept. Defaults
                              to "/"
                            type: string
                          pathRegexp:
                            description: Path regular expression filter for the intercept.
                            type: string
                          pathSuffix:
                            description: Path suffix filter for the intercept.
                            type: string
                          plaintext:
                            description: Use plaintext format when communicating with
                              the interceptor process on the local workstation. Only
                              meaningful when intercepting workloads annotated with
                              "getambassador.io/inject-originating-tls-secret" to
                              prevent that TLS is used during intercepts
                            type: boolean
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: The port that will be intercepted.
                            x-kubernetes-int-or-string: true
                          previewURL:
                            properties:
                              banner:
                                description: Display banner on preview page (default
                                  true)
                                type: boolean
                              enable:
                                description: Enable preview URL (default true)
                                type: boolean
                              extraHeaders:
                                description: Additional headers in key1=value1,key2=value2
                                  pairs injected in every preview page request
                                items:
                                  properties:
                                    name:
                                      pattern: ^[a-zA-Z][a-zA-Z0-9._-]*$
                                      type: string
                                    value:
                                      type: string
                                  required:
                                  - name
                                  - value
                                  type: object
                                type: array
                                x-kubernetes-list-map-keys:
                                - name
                                x-kubernetes-list-type: map
                              ingress:
                                properties:
                                  host:
                                    description: The ingress hostname.
                                    type: string
                                  l5Host:
                                    description: The ingress L5 Hostname. Defaults
                                      to ingressHost
                                    type: string
                                  port:
                                    description: The ingress port.
                                    maximum: 65535
                                    minimum: 1
                                    type: integer
                                  tls:
                                    description: Determines if TLS is used.
                                    type: boolean
                                type: object
                            type: object
                          service:
                            description: Name of service to intercept
                            pattern: ^[a-z][a-z0-9-]{1,62}$
                            type: string
                        required:
                        - handler
                        type: object
                      maxItems: 16
                      minItems: 1
                      type: array
                    name:
                      maxLength: 64
                      pattern: ^[a-z][a-z0-9-]*$
                      type: string
                    namespace:
                      description: The namespace for the workload and services
                      maxLength: 64
                      pattern: ^[a-z0-9][a-z0-9-]*$
                      type: string
                  required:
                  - name
                  type: object
                maxItems: 32
                minItems: 1
                type: array
            title: Telepresence Intercept Specification
            type: object
            x-kubernetes-validations:
            - message: prerequistes create must reference an existing handler name
              rule: '!has(self.prerequisites) || self.prerequisites.all(p, self.handlers.exists(h,
                h.name == p.create))'
            - message: prerequistes delete must reference an existing handler name
              rule: '!has(self.prerequisites) || self.prerequisites.all(p, !has(p.delete)
                || self.handlers.exists(h, h.name == p.delete))'
            - message: intercepts handler must reference an existing handler name
              rule: self.workloads.all(w, w.intercepts.all(i, self.handlers.exists(h,
                h.name == i.handler)))
        type: object
    served: true
    storage: true
  - name: v1alpha2
    schema:
      openAPIV3Schema:
        properties:
          spec:
            description: The Intercept Specification defines Telepresence intercepts.
            properties:
              connection:
                description: Connection properties to use when Telepresence connects
                  to the cluster.
                properties:
                  alsoProxy:
                    description: Additional comma separated list of CIDR to proxy.
                    items:
                      type: string
                    type: array
                  as:
                    description: Username to impersonate for the operation.
                    type: string
                  asGroups:
                    description: Groups to impersonate for the operation.
                    items:
                      type: string
                    type: array
                  asUID:
                    description: UID to impersonate for the operation.
                    type: string
                  cluster:
                    description: The name of the kubeconfig cluster to use
                    type: string
                  context:
                    description: The name of the kubeconfig context to use
                    type: string
                  managerNamespace:
                    description: The namespace where the traffic manager is to be
                      found.
                    pattern: ^[a-z0-9][a-z0-9-]{1,62}$
                    type: string
                  mappedNamespaces:
                    description: The namespaces that Telepresence will be concerned
                      with
                    items:
                      description: RFC 1123 label name
                      pattern: ^[a-z0-9][a-z0-9-]{1,62}$
                      type: string
                    type: array
                  neverProxy:
                    description: Comma separated list of CIDR to never proxy.
                    items:
                      type: string
                    type: array
                  user:
                    description: The name of the kubeconfig user to use
                    type: string
                type: object
              handlers:
                items:
                  oneOf:
                  - not:
                      required:
                      - docker
                    required:
                    - script
                  - not:
                      required:
                      - script
                    required:
                    - docker
                  properties:
                    docker:
                      description: docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND]
                        [ARG...]
                      oneOf:
                      - not:
                          required:
                          - build
                        required:
                        - image
                      - not:
                          required:
                          - image
                        required:
                        - build
                      properties:
                        args:
                          description: Optional command arguments
                          items:
                            type: string
                          type: array
                        build:
                          description: Build Docker image from source
                          properties:
                            args:
                              description: Optional docker build command arguments
                              items:
                                type: string
                              type: array
                            context:
                              description: A path to a directory containing a Dockerfile,
                                or a url to a git repository
                              type: string
                          required:
                          - context
                          type: object
                        command:
                          description: Optional command
                          type: string
                        image:
                          description: Image to run in the form IMAGE[:TAG|@DIGEST]
                          pattern: ^([a-zA-Z][a-zA-Z0-9._-]+(:\d+)?/)?[a-z0-9._-]+(/[a-z0-9._-]+)*((@[a-z0-9]+:[a-z0-9]+)|(:[a-zA-Z0-9._-]{1,128}))?$
                          type: string
                        options:
                          description: Options (flags) to pass to docker run
                          items:
                            type: string
                          type: array
                        ports:
                          description: Non intercept related ports exposed to the
                            host, such as ports used for debugging
                          items:
                            maximum: 65535
                            minimum: 1
                            type: integer
                          type: array
                      type: object
                    environment:
                      description: Additional environment
                      items:
                        properties:
                          name:
                            pattern: ^[a-zA-Z_][a-zA-Z0-9_]*$
                            type: string
                          value:
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                      x-kubernetes-list-map-keys:
                      - name
                      x-kubernetes-list-type: map
                    name:
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                    script:
                      description: Run a script using a shell
                      properties:
                        run:
                          description: Script to run with a shell.
                          type: string
                        shell:
                          description: The shell used when running the script.
                          enum:
                          - bash
                          - zsh
                          - sh
                          type: string
                      required:
                      - run
                      type: object
                    stopGracePeriod:
                      description: Number of seconds to wait after a SIGTERM before
                        the SIGKILL arrives
                      type: integer
                  required:
                  - name
                  type: object
                maxItems: 64
                minItems: 1
                type: array
                x-kubernetes-list-map-keys:
                - name
                x-kubernetes-list-type: map
              name:
                description: An name to give to the specification.
                pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                type: string
              prerequisites:
                items:
                  description: Things to create prior to starting any intercepts,
                    and delete once the intercept is complete.
                  properties:
                    create:
                      description: A handler to create things prior to starting any
                        intercepts.
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                    delete:
                      description: A handler to delete the created things once all
                        intercepts have ended.
                      maxLength: 64
                      pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                      type: string
                  required:
                  - create
                  type: object
                maxItems: 16
                type: array
              workloads:
                description: Remote workloads that are intercepted, keyed by workload
                  name.
                items:
                  description: An intercepted workload (Deployment, ReplicaSet or
                    StatefulSet), keyed by name.
                  maxProperties: 3
                  properties:
                    intercepts:
                      description: The services and/or ports to intercept
                      items:
                        properties:
                          enabled:
                            description: If set to false, disables this intercept.
                              Default is true
                            type: boolean
                          global:
                            description: If true, then intercept all tcp/udp traffic.
                              Mutually exclusive with headers and pathXxx properties
                            type: boolean
                          handler:
                            description: The intercept handler that handles this intercept.
                            maxLength: 64
                            pattern: ^[a-zA-Z][a-zA-Z0-9_-]*$
                            type: string
                          headers:
                            description: Headers that will filter the intercept. If
                              omitted or empty, and if global isn't explicitly set
                              to true, an auto header will be generated
                            items:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                            x-kubernetes-list-map-keys:
                            - name
                            x-kubernetes-list-type: map
                          localAddress:
                            description: The local IP address that will receive the
                              intercepted traffic.
                            pattern: ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$
                            type: string
                          localPort:
                            description: The local port that will receive the intercepted
                              traffic.
                            maximum: 65535
                            minimum: 1
                            type: integer
                          meta:
                            description: Metadata that will be returned by the Telepresence
                              API server
                            items:
                              properties:
                                name:
                                  pattern: ^[a-zA-Z][a-zA-Z0-9._-]*$
                                  type: string
                                value:
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                            x-kubernetes-list-map-keys:
                            - name
                            x-kubernetes-list-type: map
                          mountPoint:
                            description: The local directory or drive where the remote
                              volumes are mounted
                            type: string
                          pathEqual:
                            description: Path filter for the intercept.
                            type: string
                          pathPrefix:
                            description: Path prefix filter for the intercept. Defaults
                              to "/"
                            type: string
                          pathRegexp:
                            description: Path regular expression filter for the intercept.
                            type: string
                          pathSuffix:
                            description: Path suffix filter for the intercept.
                            type: string
                          plaintext:
                            description: Use plaintext format when communicating with
                              the interceptor process on the local workstation. Only
                              meaningful when intercepting workloads annotated with
                              "getambassador.io/inject-originating-tls-secret" to
                              prevent that TLS is used during intercepts
                            type: boolean
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: The port that will be intercepted.
                            x-kubernetes-int-or-string: true
                          previewURL:
                            properties:
                              banner:
                                description: Display banner on preview page (default
                                  true)
                                type: boolean
                              enable:
                                description: Enable preview URL (default true)
                                type: boolean
                              extraHeaders:
                                description: Additional headers in key1=value1,key2=value2
                                  pairs injected in every preview page request
                                items:
                                  properties:
                                    name:
                                      pattern: ^[a-zA-Z][a-zA-Z0-9._-]*$
                                      type: string
                                    value:
                                      type: string
                                  required:
                                  - name
                                  - value
                                  type: object
                                type: array
                                x-kubernetes-list-map-keys:
                                - name
                                x-kubernetes-list-type: map
                              ingress:
                                properties:
                                  host:
                                    description: The ingress hostname.
                                    type: string
                                  l5Host:
                                    description: The ingress L5 Hostname. Defaults
                                      to ingressHost
                                    type: string
                                  port:
                                    description: The ingress port.
                                    maximum: 65535
                                    minimum: 1
                                    type: integer
                                  tls:
                                    description: Determines if TLS is used.
                                    type: boolean
                                type: object
                            type: object
                          service:
                            description: Name of service to intercept
                            pattern: ^[a-z][a-z0-9-]{1,62}$
                            type: string
                        required:
                        - handler
                        type: object
                      maxItems: 16
                      minItems: 1
                      type: array
                    name:
                      maxLength: 64
                      pattern: ^[a-z][a-z0-9-]*$
                      type: string
                    namespace:
                      description: The namespace for the workload and services
                      maxLength: 64
                      pattern: ^[a-z0-9][a-z0-9-]{1,62}$
                      type: string
                  required:
                  - name
                  type: object
                maxItems: 32
                minItems: 1
                type: array
            title: Telepresence Intercept Specification
            type: object
            x-kubernetes-validations:
            - message: prerequistes create must reference an existing handler name
              rule: '!has(self.prerequisites) || self.prerequisites.all(p, self.handlers.exists(h,
                h.name == p.create))'
            - message: prerequistes delete must reference an existing handler name
              rule: '!has(self.prerequisites) || self.prerequisites.all(p, !has(p.delete)
                || self.handlers.exists(h, h.name == p.delete))'
            - message: intercepts handler must reference an existing handler name
              rule: self.workloads.all(w, w.intercepts.all(i, self.handlers.exists(h,
                h.name == i.handler)))
        type: object
    served: true
    storage: false
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: null
  storedVersions: null
